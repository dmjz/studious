{% extends "base.html" %}
{% load static %}

{% block title %}Studious - Edit lesson{% endblock %}

{% block head %}
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/10.0.0/markdown-it.min.js"
    crossorigin="anonymous">
</script>
{% endblock %}

{% block content %}
<div class="row mb-2">
    <!-- New Lesson form with textarea to write Markdown -->
    <div class="col-sm-6">
        <h1 class="display-4">Edit Lesson</h1>
        <form method="POST" action="{% url 'edit' lesson_id=lesson_id %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="titleFormInput">Title</label>
                <input 
                    type="text" 
                    class="form-control" 
                    id="titleFormInput" 
                    name="titleFormInput" 
                    maxlength="500"
                    value="{{ lesson.title }}"
                    >
            </div>
            <div class="form-group">
                <label for="fullLessonFormTextarea">Lesson</label>
                <textarea 
                    class="form-control" 
                    id="fullLessonFormTextarea" 
                    rows="8" 
                    name="fullLessonFormTextarea"
                    >{{ lesson.lesson }}</textarea>
            </div>

            <label for="review-group">Review Questions</label>
            <div id="review-group" class="form-group">
                {% for ex in lesson.examples %}
                <div class="form-row mb-2">
                    <div class="col-sm-8">
                        <input 
                            id="question-{{ forloop.counter0 }}" 
                            name="question-{{ forloop.counter0 }}" 
                            type="text" 
                            class="form-control"
                            placeholder="Question"
                            {% if ex.question %} value="{{ ex.question }}" {% endif %}
                        >
                    </div>
                    <div class="col-sm-4">
                        <input 
                            id="answer-{{ forloop.counter0 }}"
                            name="answer-{{ forloop.counter0 }}" 
                            type="text" 
                            class="form-control" 
                            placeholder="Answer"
                            {% if ex.answer %} value="{{ ex.answer }}" {% endif %}
                        >
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Edit-related buttons -->
            <button type="submit" class="btn btn-primary">Save edits</button>
            <button 
                class="btn btn-secondary"
                onclick="window.history.back()"
            >Cancel and exit</button>
        </form>
    </div>

    <div class="col-sm-6">
        <!-- Containers to for text, HTML parsed from edit form -->
        <h4 id="title-target" class="display-4"></h4>
        <div id="preview-target" class="container-fluid color-2"></div>
        <div id="examples-target" class="container-fluid color-2"></div>
    </div>
</div>
{% endblock %}

{% block endbody %}
<script src="{% static 'lib/edit_lesson.js' %}"></script>
{% endblock %}